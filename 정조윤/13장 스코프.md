스코프
======
## 들어가기 전, 사소한 용어 정리
1. 식별자 결정 : 이름이 같은 두 개의 변수 중에서 어떤 변수를 참조해야 할 것인지를 자바스크립트 엔진이 결정하는 것
2. 렉시컬 환경 : 코드가 어디서 실행되며 주변에 어떤 코드가 있는지를 뜻함.
3. 렉시컬 스코프 : 함수를 어디서 호출했는지(동적 스코프)가 아니라 함수를 어디서 정의했는지(정적 스코프)에 따라 상위 스코프를 정적으로 결정한다. 

## 스코프란?
- 자바스크립트를 포함한 모든 프로그래밍 언어의 기본적이며 중요한 개념
- 모든 식별자는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정되는 것, 즉 식별자가 유효한 범위를 뜻
- 자바스크립트 엔진이 식별자를 검색할 때 사용하는 규칙
- 지역 변수나 전역 변수는 자신의 스코프와 하위 지역 스코프에서 유효합니다.

## 자바스크립트 엔진이 코드를 실행할 때 고려하는 것은?
```javascript
var x = 'global';

var foo = function () {
    var x = "local";
    console.log(x); // 1번
}

foo();

console.log(x); // 2번
```
**코드의 문맥**. 즉 코드가 어디서 실행되며 주변에 어떤 코드가 있는지에 따라 위 예제의 1번과 2번처럼 동일한 코드도 다른 결과를 만들어 냅니다. 코드의 문맥은 **렉시컬 환경** 으로 이뤄집니다.

## 스코프라는 개념이 존재할 때 얻는 이점은?
컴퓨터를 사용할 때 하나의 파일 이름을 여러 번 사용하는 것처럼(예 : 복사 붙여넣기 할 때) 스코프를 통해 식별자인 변수 이름의 충돌을 방지하여 같은 이름의 변수를 사용할 수 있게 합니다.

## 스코프 체인이란?
- 지역이란 함수 몸체 내부를 말합니다. 지역은 지역 스코프를 만들고, 지역에 변수를 선언하면 지역 스코프를 갖는 지역 변수가 됩니다. 때문에 스코프란 함수에 의해서 발생한 개념이라고 생각합니다. 
- 12장에서 설명한 함수 몸체 내부에서 정의한 함수인 중첩 함수, 즉 함수는 중첩될 수 있으므로 함수의 지역 스코프도 중첩될 수 있습니다. 이는 중첩 함수의 지역 스코프는 중첩 함수를 포함하는 외부 함수의 지역 스코프와 계층적 구조를 갖는다는 말입니다. 
- 이렇게 스코프가 전역 -> 지역 -> 지역 -> ... 같이 계층적으로 연결된 것을 **스코프 체인**이라 합니다. 모든 지역 스코프의 **최상위 스코프**는 **전역 스코프**입니다.

## 그러면, 스코프는 어떻게 쓰이는 건가요?
- 스코프를 이용할 때는 식별자를 사용할 때와 연관이 있는데, 이를 찾으려면 **스코프 체인**을 통해서 변수를 검색할 수 있다.
- 변수를 참조할 때, 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색합니다. 절대 하위 스코프로 내려가면서 식별자를 검색하는 일 X
    - 즉, 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만, 하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다는 것을 의미합니다.

## 스코프에 대해서 주의해야 할 점은?
- 자바스크립트의 스코프는 다른 언어의 스코프와 구별되는 특징이 있으므로 주의가 필요
- var 키워드로 선언한 변수와 let 또는 const 키워드로 선언한 변수의 스코프도 다르게 동작
- 함수도 식별자에 할당되기 때문에 스코프를 갖는다.
- 함수가 아닌 코드 블록 안의 var 키워드로 선언된 변수를 지역 변수로 인정하지 않는다.
    ```javascript
    var i = 10;

    for(var i = 0; i < 5; i++) {
        console.log(i); // 0 1 2 3 4
    }

    // 의도치 않게 변수의 값이 변경되었다.
    console.log(i); // 5
    ```
- let, const 키워드는 var 키워드와 다르게 블록 레벨 스코프를 지원한다.
- 자바스크립트는 동적 스코프를 따르지 않고, 렉시컬 스코프(정적 스코프)를 따른다.
    - 렉시컬 스코프 예시
    ```javascript
    var x = 1;

    function foo() {
        var x = 10;
        bar();
    }

    function bar() {
        console.log(x);
    }

    foo(); // 1, 동적 스코프였을 경우 함수가 호출된 위치에 따라 상위 스코프가 결정되기에 10으로 출력되지만 정적 스코프이기 때문에 처음에 결정된 함수 위치의 스코프 규칙을 따른다.
    bar(); // 1
    ```